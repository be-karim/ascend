<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>ASCEND â€“ Gamified Fitness</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Phosphor Icons -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <!-- Google Fonts -->
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Rajdhani:wght@500;600;700&display=swap"
        rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        tech: ['Rajdhani', 'sans-serif'],
                    },
                    colors: {
                        bg: '#05070A',
                        panel: '#0F1522',
                        primary: '#FF3D81',
                        secondary: '#00E5FF',
                        accent: '#7CFF00',
                        muted: '#64748b'
                    },
                    animation: {
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    }
                }
            }
        }
    </script>

    <style>
        :root {
            --glass-border: rgba(255, 255, 255, 0.08);
            --glass-bg: rgba(15, 21, 34, 0.7);
        }

        body {
            background-color: #05070A;
            background-image:
                radial-gradient(circle at 50% 0%, rgba(0, 229, 255, 0.15), transparent 40%),
                radial-gradient(circle at 80% 80%, rgba(255, 61, 129, 0.08), transparent 30%);
            background-attachment: fixed;
            color: #F5F7FF;
            -webkit-tap-highlight-color: transparent;
        }

        .tech-card {
            background: var(--glass-bg);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid var(--glass-border);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.3);
            position: relative;
            overflow: hidden;
        }

        .tech-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(to bottom, transparent, var(--glass-border), transparent);
            opacity: 0.5;
        }

        .avatar-holo {
            background:
                repeating-linear-gradient(0deg, transparent 0, transparent 2px, rgba(0, 229, 255, 0.1) 3px),
                radial-gradient(circle at 50% 50%, rgba(0, 229, 255, 0.2), transparent 70%);
            box-shadow: 0 0 15px rgba(0, 229, 255, 0.2);
            position: relative;
        }

        .avatar-holo::after {
            content: '';
            position: absolute;
            inset: 2px;
            border: 1px dashed rgba(0, 229, 255, 0.3);
            border-radius: 50%;
            animation: spin 10s linear infinite;
        }

        @keyframes spin {
            100% {
                transform: rotate(360deg);
            }
        }

        .nav-btn.active {
            background: rgba(255, 255, 255, 0.1);
            color: #00E5FF;
            border-bottom: 2px solid #00E5FF;
        }

        .screen {
            display: none;
            animation: fadeIn 0.3s ease-out;
        }

        .screen.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Calendar Grid */
        .cal-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 6px;
        }

        .cal-day {
            aspect-ratio: 1;
            border-radius: 6px;
            background: rgba(255, 255, 255, 0.05);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-family: 'Rajdhani', sans-serif;
            color: #64748b;
        }

        .cal-day.active {
            background: rgba(124, 255, 0, 0.2);
            color: #7CFF00;
            border: 1px solid rgba(124, 255, 0, 0.4);
            box-shadow: 0 0 8px rgba(124, 255, 0, 0.1);
        }
    </style>
</head>

<body class="min-h-screen text-gray-100 font-sans pb-24">

    <!-- APP CONTAINER -->
    <div class="max-w-lg mx-auto min-h-screen relative flex flex-col">

        <!-- HEADER -->
        <header
            class="sticky top-0 z-50 bg-[#05070A]/80 backdrop-blur-md border-b border-white/5 px-5 py-4 flex justify-between items-center">
            <div>
                <h1
                    class="font-tech font-bold text-2xl tracking-widest bg-clip-text text-transparent bg-gradient-to-r from-primary to-secondary">
                    ASCEND</h1>
                <div class="text-[10px] text-muted tracking-[0.2em] uppercase">System Online</div>
            </div>

            <div class="flex items-center gap-3">
                <div class="text-right">
                    <div class="text-xs text-secondary font-tech tracking-wider">LVL <span id="header-lvl">4</span>
                    </div>
                    <div class="w-24 h-1.5 bg-gray-800 rounded-full mt-1 overflow-hidden">
                        <div id="header-xp-bar"
                            class="h-full bg-gradient-to-r from-primary to-secondary w-[65%] transition-all duration-500">
                        </div>
                    </div>
                </div>
                <div class="w-8 h-8 rounded-full border border-white/20 flex items-center justify-center bg-panel">
                    <i class="ph-bold ph-user text-white"></i>
                </div>
            </div>
        </header>

        <!-- NAVIGATION -->
        <nav class="px-4 py-3 sticky top-[73px] z-40 bg-[#05070A]/90 backdrop-blur-sm">
            <div class="flex p-1 bg-white/5 rounded-xl border border-white/5 backdrop-blur-md">
                <button onclick="nav('today')" id="nav-today"
                    class="nav-btn active flex-1 py-2.5 rounded-lg text-sm font-bold transition-all flex items-center justify-center gap-2">
                    <i class="ph-bold ph-calendar-check"></i> Today
                </button>
                <button onclick="nav('challenges')" id="nav-challenges"
                    class="nav-btn flex-1 py-2.5 rounded-lg text-sm font-bold transition-all flex items-center justify-center gap-2">
                    <i class="ph-bold ph-trophy"></i> Tasks
                </button>
                <button onclick="nav('profile')" id="nav-profile"
                    class="nav-btn flex-1 py-2.5 rounded-lg text-sm font-bold transition-all flex items-center justify-center gap-2">
                    <i class="ph-bold ph-chart-bar"></i> Stats
                </button>
            </div>
        </nav>

        <!-- MAIN CONTENT AREA -->
        <main class="flex-1 p-5 space-y-6">

            <!-- SCREEN: TODAY -->
            <div id="today" class="screen active space-y-6">

                <!-- Hero Avatar Section -->
                <div class="tech-card rounded-3xl p-6 text-center relative">
                    <div
                        class="absolute top-4 right-4 text-accent text-xs font-tech border border-accent/30 px-2 py-0.5 rounded uppercase">
                        Active</div>

                    <div
                        class="w-32 h-32 mx-auto rounded-full avatar-holo flex items-center justify-center mb-4 border-2 border-secondary/30">
                        <div class="text-4xl font-tech font-bold text-white drop-shadow-[0_0_10px_rgba(0,229,255,0.8)]"
                            id="hero-lvl">4</div>
                    </div>

                    <h2 class="text-xl font-bold tracking-wide">Daily Objective</h2>
                    <p class="text-sm text-gray-400 mt-1">Consistency is key, Operator.</p>

                    <div class="mt-6 grid grid-cols-3 gap-2">
                        <div class="bg-white/5 p-3 rounded-xl border border-white/5">
                            <div class="text-xs text-gray-400 uppercase font-tech">Streak</div>
                            <div class="text-lg font-bold text-accent" id="hero-streak">6</div>
                        </div>
                        <div class="bg-white/5 p-3 rounded-xl border border-white/5">
                            <div class="text-xs text-gray-400 uppercase font-tech">XP Today</div>
                            <div class="text-lg font-bold text-primary" id="hero-xp-today">150</div>
                        </div>
                        <div class="bg-white/5 p-3 rounded-xl border border-white/5">
                            <div class="text-xs text-gray-400 uppercase font-tech">Focus</div>
                            <div class="text-lg font-bold text-secondary" id="hero-focus">STR</div>
                        </div>
                    </div>
                </div>

                <!-- Priority Task -->
                <div>
                    <h3 class="text-xs font-bold text-muted uppercase tracking-[0.2em] mb-3 ml-1">Priority Target</h3>
                    <div class="tech-card rounded-2xl p-5 border-l-4 border-l-primary" id="priority-task-container">
                        <!-- Injected via JS -->
                    </div>
                </div>

            </div>

            <!-- SCREEN: CHALLENGES -->
            <div id="challenges" class="screen space-y-6">
                <div class="flex justify-between items-end">
                    <h3 class="text-xs font-bold text-muted uppercase tracking-[0.2em] ml-1">Active Protocols</h3>
                    <button onclick="toggleModal('add-modal')"
                        class="bg-white/10 hover:bg-white/20 p-2 rounded-full transition-colors">
                        <i class="ph-bold ph-plus text-secondary"></i>
                    </button>
                </div>

                <div id="challenges-list" class="space-y-3">
                    <!-- Populated by JS -->
                </div>
            </div>

            <!-- SCREEN: PROFILE/STATS -->
            <div id="profile" class="screen space-y-6">
                <div class="tech-card rounded-3xl p-6">
                    <h2 class="text-xl font-bold mb-4">Operator Statistics</h2>

                    <div class="space-y-4">
                        <div class="flex flex-col items-center mb-6">
                            <canvas id="stats-radar" width="240" height="240" class="w-full max-w-[240px]"></canvas>
                        </div>

                        <div id="stats-bars-container" class="space-y-4 mb-6">
                            <!-- Injected via JS -->
                        </div>

                        <!-- STREAK CALENDAR -->
                        <div class="mt-6">
                            <div class="flex justify-between items-end mb-2">
                                <span class="text-xs text-gray-500 uppercase tracking-widest">Activity Matrix</span>
                                <span class="text-xs font-tech text-accent">Last 14 Days</span>
                            </div>
                            <div class="cal-grid" id="streak-calendar">
                                <!-- Injected by JS -->
                            </div>
                        </div>

                        <div class="grid grid-cols-2 gap-3 mt-4">
                            <div class="p-4 rounded-xl bg-[#080B12] border border-white/5">
                                <i class="ph-fill ph-fire text-primary text-xl mb-2"></i>
                                <div class="text-2xl font-bold" id="stats-total-streak">6</div>
                                <div class="text-xs text-gray-500 uppercase">Day Streak</div>
                            </div>
                            <div class="p-4 rounded-xl bg-[#080B12] border border-white/5">
                                <i class="ph-fill ph-check-circle text-accent text-xl mb-2"></i>
                                <div class="text-2xl font-bold" id="stats-completed">42</div>
                                <div class="text-xs text-gray-500 uppercase">Tasks Done</div>
                            </div>
                        </div>
                    </div>
                </div>

                <button onclick="resetData()"
                    class="w-full py-3 text-xs text-red-400 uppercase tracking-widest border border-red-500/20 rounded-xl hover:bg-red-500/10 transition-colors">
                    Reset System Data
                </button>
            </div>

        </main>
    </div>

    <!-- ADD CHALLENGE MODAL -->
    <div id="add-modal"
        class="fixed inset-0 z-[100] bg-black/80 backdrop-blur-sm hidden flex items-center justify-center p-4">
        <div class="bg-[#0F1522] w-full max-w-sm rounded-2xl border border-white/10 p-6 shadow-2xl transform transition-all scale-95 opacity-0"
            id="add-modal-content">
            <h3 class="text-lg font-bold mb-4 font-tech uppercase text-white tracking-wider">New Protocol</h3>

            <div class="space-y-4">
                <div>
                    <label class="block text-xs text-gray-500 uppercase mb-1">Tracking Type</label>
                    <div class="grid grid-cols-3 gap-2">
                        <button onclick="setModalType('reps', this)"
                            class="modal-type-btn active bg-white/10 border border-secondary text-secondary p-2 rounded-lg text-xs font-bold">Reps</button>
                        <button onclick="setModalType('time', this)"
                            class="modal-type-btn bg-[#05070A] border border-white/10 text-gray-400 p-2 rounded-lg text-xs font-bold">Time</button>
                        <button onclick="setModalType('hydration', this)"
                            class="modal-type-btn bg-[#05070A] border border-white/10 text-gray-400 p-2 rounded-lg text-xs font-bold">Fluid</button>
                    </div>
                </div>

                <div>
                    <label class="block text-xs text-gray-500 uppercase mb-1">Target Attribute</label>
                    <div class="grid grid-cols-4 gap-2">
                        <button onclick="setModalStat('str', this)"
                            class="modal-stat-btn ring-2 ring-white bg-[#FF3D81] text-white p-2 rounded-lg text-[10px] font-bold">STR</button>
                        <button onclick="setModalStat('agi', this)"
                            class="modal-stat-btn opacity-50 bg-[#00E5FF] text-black p-2 rounded-lg text-[10px] font-bold">AGI</button>
                        <button onclick="setModalStat('int', this)"
                            class="modal-stat-btn opacity-50 bg-[#E0E0E0] text-black p-2 rounded-lg text-[10px] font-bold">INT</button>
                        <button onclick="setModalStat('dis', this)"
                            class="modal-stat-btn opacity-50 bg-[#7CFF00] text-black p-2 rounded-lg text-[10px] font-bold">DIS</button>
                    </div>
                </div>

                <div>
                    <label class="block text-xs text-gray-500 uppercase mb-1">Task Name</label>
                    <input type="text" id="new-task-name" placeholder="e.g. Push Ups"
                        class="w-full bg-[#05070A] border border-white/10 rounded-xl p-3 text-white focus:border-secondary focus:outline-none transition-colors">
                </div>

                <div class="grid grid-cols-2 gap-3">
                    <div>
                        <label class="block text-xs text-gray-500 uppercase mb-1">Target</label>
                        <input type="number" id="new-task-target" placeholder="100"
                            class="w-full bg-[#05070A] border border-white/10 rounded-xl p-3 text-white focus:border-secondary focus:outline-none transition-colors">
                    </div>
                    <div>
                        <label class="block text-xs text-gray-500 uppercase mb-1">Unit</label>
                        <input type="text" id="new-task-unit" value="reps"
                            class="w-full bg-[#05070A] border border-white/10 rounded-xl p-3 text-white focus:border-secondary focus:outline-none transition-colors">
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-2 gap-3 mt-6">
                <button onclick="toggleModal('add-modal')"
                    class="py-3 rounded-xl bg-white/5 text-gray-400 font-bold hover:bg-white/10">Cancel</button>
                <button onclick="addChallenge()"
                    class="py-3 rounded-xl bg-gradient-to-r from-primary to-secondary text-black font-bold shadow-[0_0_15px_rgba(0,229,255,0.4)]">Initialize</button>
            </div>
        </div>
    </div>

    <!-- NOTIFICATION TOAST -->
    <div id="toast"
        class="fixed bottom-6 left-1/2 transform -translate-x-1/2 bg-[#0F1522] border border-accent/50 text-accent px-6 py-3 rounded-full shadow-[0_0_20px_rgba(124,255,0,0.2)] flex items-center gap-3 translate-y-20 transition-all duration-300 z-[100]">
        <i class="ph-fill ph-check-circle"></i>
        <span class="font-bold text-sm tracking-wide" id="toast-msg">Task Updated</span>
    </div>

    <script>
        // --- STATE MANAGEMENT ---
        const defaultState = {
            streak: 6,
            tasksCompleted: 42,
            xpToday: 150,
            stats: {
                // Tier 0 = Iron, 1 = Bronze, etc.
                str: { level: 12, current: 450, max: 800, tier: 0, label: 'Strength', color: '#FF3D81' }, // Primary
                agi: { level: 8, current: 200, max: 500, tier: 0, label: 'Agility', color: '#00E5FF' },   // Secondary
                int: { level: 5, current: 100, max: 300, tier: 0, label: 'Intellect', color: '#E0E0E0' }, // White/Gray
                dis: { level: 20, current: 1200, max: 1500, tier: 1, label: 'Discipline', color: '#7CFF00' } // Accent
            },
            history: [1, 1, 0, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1],
            challenges: [
                { id: 1, name: 'Push-Ups', current: 45, target: 100, unit: 'reps', type: 'reps', stat: 'str' },
                { id: 2, name: 'Target Reading', current: 0, target: 30, unit: 'min', type: 'time', stat: 'int' },
                { id: 3, name: 'Meditation', current: 0, target: 15, unit: 'min', type: 'time', stat: 'dis' },
                { id: 4, name: 'Morning Run', current: 0, target: 5, unit: 'km', type: 'reps', stat: 'agi' }
            ]
        };

        let appState = JSON.parse(localStorage.getItem('ascendState_v2')) || defaultState;
        let activeTimer = null;
        let selectedType = 'reps';
        let selectedStat = 'str';

        // --- CORE FUNCTIONS ---

        function saveState() {
            localStorage.setItem('ascendState_v2', JSON.stringify(appState));
            renderAll();
        }

        function nav(screenId) {
            document.querySelectorAll('.screen').forEach(el => el.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active', 'text-[#00E5FF]'));
            document.getElementById(`nav-${screenId}`).classList.add('active');

            if (screenId === 'profile') {
                setTimeout(drawRadarChart, 100); // Wait for visibility
            }
        }

        function calculateProgress(current, target) {
            // Handle division by zero or negative
            if (target <= 0) return 100;
            return Math.min(100, Math.round((current / target) * 100));
        }

        function updateTask(id, amount, isManualInput = false) {
            const task = appState.challenges.find(c => c.id === id);
            if (!task) return;

            if (isManualInput) {
                const input = prompt(`Enter ${task.unit} for ${task.name}:`);
                if (input) amount = parseInt(input);
                else return;
            }

            const oldComplete = task.current >= task.target;
            task.current = Math.min(task.target, Math.max(0, task.current + amount));
            const newComplete = task.current >= task.target;

            if (amount > 0) {
                // Add XP to specific stat
                const xpGain = task.type === 'time' ? 2 : 5;
                addStatXP(task.stat, xpGain);
                if (!isManualInput && task.type !== 'time') showToast(`+${amount} ${task.unit}`);
            }

            if (!oldComplete && newComplete) {
                showToast(`TASK COMPLETE: ${task.name}`);
                confettiEffect();
            }

            saveState();
        }

        function addStatXP(statKey, amount) {
            const s = appState.stats[statKey];
            s.current += amount;
            appState.xpToday += amount;

            if (s.current >= s.max) {
                s.level++;
                s.current -= s.max;
                // Curve: 100 * level^1.5
                s.max = Math.floor(100 * Math.pow(s.level, 1.5));

                // Tier Logic
                if (s.level > 100) {
                    s.tier++;
                    s.level = 1;
                    s.max = 100;
                    showToast(`${s.label} ASCENDED to Tier ${s.tier}!`);
                } else {
                    showToast(`${s.label} Level Up: ${s.level}!`);
                }
            }
        }

        // --- TIMER LOGIC ---
        function toggleTimer(id) {
            const task = appState.challenges.find(c => c.id === id);
            if (!task) return;

            if (task.isRunning) {
                task.isRunning = false;
                clearInterval(activeTimer);
                activeTimer = null;
            } else {
                appState.challenges.forEach(t => t.isRunning = false);
                if (activeTimer) clearInterval(activeTimer);

                task.isRunning = true;
                activeTimer = setInterval(() => {
                    if (task.current < task.target) {
                        task.current += (1 / 60); // 1 sec tick

                        // Passively add XP? Maybe every minute.
                        // For now just on completion or manual stop logic if needed.

                        if (task.current >= task.target) {
                            task.current = task.target;
                            task.isRunning = false;
                            clearInterval(activeTimer);
                            activeTimer = null;
                            showToast(`TIMER FINISHED: ${task.name}`);
                            addStatXP(task.stat, 50); // Big bonus for full timer
                            confettiEffect();
                        }
                        saveState();
                    }
                }, 1000);
            }
            saveState();
        }

        function formatTime(minutes) {
            const m = Math.floor(minutes);
            const s = Math.floor((minutes - m) * 60);
            return `${m}:${s < 10 ? '0' + s : s}`;
        }

        // --- ADDING TASKS ---

        function setModalType(type, btn) {
            selectedType = type;
            document.querySelectorAll('.modal-type-btn').forEach(b => {
                b.classList.remove('active', 'border-secondary', 'text-secondary', 'bg-white/10');
                b.classList.add('bg-[#05070A]', 'border-white/10', 'text-gray-400');
            });
            btn.classList.remove('bg-[#05070A]', 'border-white/10', 'text-gray-400');
            btn.classList.add('active', 'bg-white/10', 'border-secondary', 'text-secondary');

            const unitInput = document.getElementById('new-task-unit');
            if (type === 'reps') unitInput.value = 'reps';
            if (type === 'time') unitInput.value = 'min';
            if (type === 'hydration') unitInput.value = 'ml';
        }

        function setModalStat(stat, btn) {
            selectedStat = stat;
            document.querySelectorAll('.modal-stat-btn').forEach(b => {
                b.classList.remove('ring-2', 'ring-white');
                b.classList.add('opacity-50');
            });
            btn.classList.remove('opacity-50');
            btn.classList.add('ring-2', 'ring-white');
        }

        function addChallenge() {
            const name = document.getElementById('new-task-name').value;
            const target = parseInt(document.getElementById('new-task-target').value);
            const unit = document.getElementById('new-task-unit').value;

            if (name && target) {
                appState.challenges.push({
                    id: Date.now(),
                    name: name,
                    current: 0,
                    target: target,
                    unit: unit,
                    type: selectedType,
                    stat: selectedStat,
                    isRunning: false
                });
                toggleModal('add-modal');
                saveState();
                showToast('Protocol Initiated');

                document.getElementById('new-task-name').value = '';
                document.getElementById('new-task-target').value = '';
            }
        }

        function deleteChallenge(id) {
            if (confirm('Abort protocol?')) {
                const task = appState.challenges.find(c => c.id === id);
                if (task && task.isRunning) {
                    clearInterval(activeTimer);
                    activeTimer = null;
                }
                appState.challenges = appState.challenges.filter(c => c.id !== id);
                saveState();
            }
        }

        // --- RENDER FUNCTIONS ---

        function renderHeader() {
            // Header Level is now Average or Highest? Let's use Sum of Levels
            const totalLvl = appState.stats.str.level + appState.stats.agi.level + appState.stats.int.level + appState.stats.dis.level;

            document.getElementById('header-lvl').innerText = totalLvl;
            // No single XP bar for header anymore, maybe show highest stat progress or just hide it
            // Let's show average progress?
            document.getElementById('header-xp-bar').style.width = '100%';
            document.getElementById('header-xp-bar').classList.add('animate-pulse');

            document.getElementById('hero-lvl').innerText = totalLvl;
            document.getElementById('hero-streak').innerText = appState.streak;
            document.getElementById('hero-xp-today').innerText = Math.floor(appState.xpToday);

            // Calculate Focus (Highest Stat)
            const s = appState.stats;
            const highestKey = Object.keys(s).reduce((a, b) => s[a].level > s[b].level ? a : b);
            const focusEl = document.getElementById('hero-focus');
            focusEl.innerText = s[highestKey].label.toUpperCase();
            focusEl.style.color = s[highestKey].color;
        }

        function getControlsForType(task, isComplete) {
            if (isComplete) return `<div class="text-xs text-accent font-bold uppercase tracking-widest py-1"><i class="ph-fill ph-check-circle inline-block mr-1"></i> Done</div>`;
            if (task.type === 'time') {
                return `
                    <div class="flex items-center gap-3">
                        <div class="font-tech text-xl w-16 text-right font-mono">${formatTime(task.current)}</div>
                        <button onclick="toggleTimer(${task.id})" class="h-10 w-10 rounded-full ${task.isRunning ? 'bg-accent text-black animate-pulse' : 'bg-white/10 text-white'} flex items-center justify-center transition-all">
                            <i class="ph-fill ${task.isRunning ? 'ph-pause' : 'ph-play'} text-lg"></i>
                        </button>
                    </div>
                `;
            } else if (task.type === 'hydration') {
                return `
                    <button onclick="updateTask(${task.id}, 250)" class="h-8 px-3 rounded-lg bg-blue-500/20 hover:bg-blue-500/30 border border-blue-500/30 text-blue-300 text-xs font-bold transition-all flex items-center gap-1"><i class="ph-bold ph-drop"></i> 250</button>
                    <button onclick="updateTask(${task.id}, 500)" class="h-8 px-3 rounded-lg bg-blue-500/20 hover:bg-blue-500/30 border border-blue-500/30 text-blue-300 text-xs font-bold transition-all flex items-center gap-1"><i class="ph-bold ph-drop"></i> 500</button>
                `;
            } else {
                return `
                    <button onclick="updateTask(${task.id}, 0, true)" class="h-8 w-8 rounded-lg bg-white/5 hover:bg-white/10 border border-white/5 text-gray-400 text-xs font-bold flex items-center justify-center"><i class="ph-bold ph-pencil-simple"></i></button>
                    <button onclick="updateTask(${task.id}, 5)" class="h-8 px-3 rounded-lg bg-white/5 hover:bg-white/10 border border-white/5 text-xs font-bold transition-all">+5</button>
                    <button onclick="updateTask(${task.id}, 10)" class="h-8 px-3 rounded-lg bg-white/5 hover:bg-white/10 border border-white/5 text-xs font-bold transition-all">+10</button>
                `;
            }
        }

        function renderChallenges() {
            const container = document.getElementById('challenges-list');
            const priorityContainer = document.getElementById('priority-task-container');
            container.innerHTML = '';

            const sortedTasks = [...appState.challenges].sort((a, b) => {
                if (a.isRunning !== b.isRunning) return a.isRunning ? -1 : 1;
                return (a.current / a.target) - (b.current / b.target);
            });

            sortedTasks.forEach((task, index) => {
                const percent = calculateProgress(task.current, task.target);
                const isComplete = percent >= 100;
                let displayValue = `${Math.floor(task.current)} / ${task.target} ${task.unit}`;
                if (task.type === 'time') displayValue = `${formatTime(task.current)} / ${task.target} min`;

                const statColor = appState.stats[task.stat].color;

                const html = `
                    <div class="tech-card rounded-2xl p-4 ${isComplete ? 'opacity-60' : ''} ${task.isRunning ? 'border-accent/50 shadow-[0_0_15px_rgba(124,255,0,0.1)]' : ''} border-l-4" style="border-left-color: ${statColor}">
                        <div class="flex justify-between items-start mb-2">
                            <div>
                                <h4 class="font-bold text-white flex items-center gap-2">
                                    ${task.name}
                                    <span class="text-[0.6rem] px-1.5 rounded bg-white/10 uppercase tracking-wider text-[${statColor}]">${task.stat}</span>
                                    ${task.isRunning ? '<span class="w-2 h-2 rounded-full bg-accent animate-pulse"></span>' : ''}
                                </h4>
                                <div class="text-xs text-gray-500 font-tech uppercase tracking-wider">${displayValue}</div>
                            </div>
                            <div class="text-right">
                                <span class="text-xl font-tech font-bold ${isComplete ? 'text-accent' : 'text-white'}">${percent}%</span>
                            </div>
                        </div>
                        
                        <div class="h-1.5 w-full bg-[#05070A] rounded-full mb-4 overflow-hidden relative">
                            <div class="h-full transition-all duration-300" style="width: ${percent}%; background-color: ${statColor}"></div>
                        </div>

                        <div class="flex gap-2 justify-end items-center">
                            ${getControlsForType(task, isComplete)}
                             <button onclick="deleteChallenge(${task.id})" class="h-8 w-8 ml-2 rounded-lg bg-red-500/5 text-red-400 hover:bg-red-500/20 flex items-center justify-center transition-colors">
                                <i class="ph-bold ph-trash"></i>
                            </button>
                        </div>
                    </div>
                `;

                container.innerHTML += html;
                if (index === 0) priorityContainer.innerHTML = html.replace('tech-card', '');
            });

            if (appState.challenges.length === 0) {
                container.innerHTML = `<div class="text-center py-10 text-gray-600 font-tech uppercase">No active protocols</div>`;
                priorityContainer.innerHTML = `<div class="text-gray-500 text-sm">No priority targets set.</div>`;
            }
        }

        // --- GRAPH & STATS ---

        function drawRadarChart() {
            const canvas = document.getElementById('stats-radar');
            if (!canvas) return;
            const ctx = canvas.getContext('2d');
            const w = canvas.width;
            const h = canvas.height;
            const centerX = w / 2;
            const centerY = h / 2;
            const radius = (Math.min(w, h) / 2) - 20;

            // Clear
            ctx.clearRect(0, 0, w, h);

            const stats = ['str', 'agi', 'int', 'dis'];
            const labels = ['STR', 'AGI', 'INT', 'DIS'];
            const colors = ['#FF3D81', '#00E5FF', '#E0E0E0', '#7CFF00'];

            // Find max level to normalize
            let maxLvl = 10; // Minimum scale
            stats.forEach(k => {
                if (appState.stats[k].level > maxLvl) maxLvl = appState.stats[k].level;
            });
            maxLvl = maxLvl * 1.1; // Add buffer

            // Draw Background Web
            ctx.strokeStyle = 'rgba(255,255,255,0.1)';
            ctx.lineWidth = 1;

            for (let r = 0.2; r <= 1; r += 0.2) {
                ctx.beginPath();
                for (let i = 0; i < 4; i++) {
                    const angle = (Math.PI * 2 * i) / 4 - Math.PI / 2;
                    const x = centerX + Math.cos(angle) * (radius * r);
                    const y = centerY + Math.sin(angle) * (radius * r);
                    if (i === 0) ctx.moveTo(x, y);
                    else ctx.lineTo(x, y);
                }
                ctx.closePath();
                ctx.stroke();
            }

            // Draw Axes & Labels
            ctx.font = 'bold 12px Rajdhani';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';

            for (let i = 0; i < 4; i++) {
                const angle = (Math.PI * 2 * i) / 4 - Math.PI / 2;
                const x = centerX + Math.cos(angle) * radius;
                const y = centerY + Math.sin(angle) * radius;

                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.lineTo(x, y);
                ctx.strokeStyle = 'rgba(255,255,255,0.1)';
                ctx.stroke();

                // Label
                const lx = centerX + Math.cos(angle) * (radius + 15);
                const ly = centerY + Math.sin(angle) * (radius + 15);
                ctx.fillStyle = colors[i];
                ctx.fillText(labels[i], lx, ly);
            }

            // Draw Data Polygon
            ctx.beginPath();
            ctx.fillStyle = 'rgba(0, 229, 255, 0.2)';
            ctx.strokeStyle = '#00E5FF';
            ctx.lineWidth = 2;

            stats.forEach((k, i) => {
                const val = appState.stats[k].level;
                const norm = val / maxLvl;
                const angle = (Math.PI * 2 * i) / 4 - Math.PI / 2;
                const x = centerX + Math.cos(angle) * (radius * norm);
                const y = centerY + Math.sin(angle) * (radius * norm);
                if (i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            });
            ctx.closePath();
            ctx.fill();
            ctx.stroke();
        }

        function renderStats() {
            // Updated Stats Area
            const container = document.getElementById('stats-bars-container');
            container.innerHTML = '';

            const stats = ['str', 'agi', 'int', 'dis'];
            stats.forEach(k => {
                const s = appState.stats[k];
                const pct = calculateProgress(s.current, s.max);

                container.innerHTML += `
                    <div class="mb-3">
                        <div class="flex justify-between text-xs mb-1 font-bold">
                            <span style="color: ${s.color}">${s.label} <span class="text-gray-500 text-[0.6rem]">TIER ${s.tier}</span></span>
                            <span class="text-white">Lvl ${s.level}</span>
                        </div>
                        <div class="h-1.5 bg-[#05070A] rounded-full overflow-hidden">
                            <div class="h-full transition-all duration-500" style="width: ${pct}%; background-color: ${s.color}"></div>
                        </div>
                        <div class="text-[0.6rem] text-right text-gray-600 mt-0.5">${s.current}/${s.max} XP</div>
                    </div>
                `;
            });

            document.getElementById('stats-total-streak').innerText = appState.streak;
            const completedCount = appState.tasksCompleted + appState.challenges.filter(c => c.current >= c.target).length;
            document.getElementById('stats-completed').innerText = completedCount;

            renderCalendar();
            setTimeout(drawRadarChart, 50);
        }

        function renderAll() {
            renderHeader();
            renderChallenges();
            renderStats();
        }

        // --- UI UTILITIES ---

        function toggleModal(id) {
            const modal = document.getElementById(id);
            const content = document.getElementById(`${id}-content`);
            if (modal.classList.contains('hidden')) {
                modal.classList.remove('hidden');
                setTimeout(() => {
                    content.classList.remove('scale-95', 'opacity-0');
                    content.classList.add('scale-100', 'opacity-100');
                }, 10);
            } else {
                content.classList.remove('scale-100', 'opacity-100');
                content.classList.add('scale-95', 'opacity-0');
                setTimeout(() => {
                    modal.classList.add('hidden');
                }, 200);
            }
        }

        function showToast(msg) {
            const toast = document.getElementById('toast');
            document.getElementById('toast-msg').innerText = msg;
            toast.classList.remove('translate-y-20');
            setTimeout(() => {
                toast.classList.add('translate-y-20');
            }, 2000);
        }

        function confettiEffect() {
            const header = document.querySelector('header');
            header.style.borderColor = '#7CFF00';
            setTimeout(() => header.style.borderColor = 'rgba(255,255,255,0.05)', 500);
        }

        function resetData() {
            if (confirm('WARNING: Factory reset system? All progress will be lost.')) {
                localStorage.removeItem('ascendState_v2');
                location.reload();
            }
        }

        function renderCalendar() {
            const cal = document.getElementById('streak-calendar');
            cal.innerHTML = '';
            const days = ['S', 'M', 'T', 'W', 'T', 'F', 'S'];
            const today = new Date().getDay();

            // Using simple mock history for now
            appState.history.forEach((status, i) => {
                const div = document.createElement('div');
                div.className = `cal-day ${status === 1 ? 'active' : ''}`;
                div.innerText = days[(today + i) % 7];
                cal.appendChild(div);
            });
        }

        // --- INIT ---
        window.onload = () => {
            appState.challenges.forEach(c => c.isRunning = false);
            renderAll();
        };

    </script>
</body>

</html>